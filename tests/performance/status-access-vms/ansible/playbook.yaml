- name: Run
  hosts: all

  tasks:
    - name: Print hostname and ip address
      ansible.builtin.debug:
        msg: "{{ ansible_host }} | {{ ansible_hostname }} - {{ ansible_default_ipv4.address }}"

  # post_tasks:
  #   - name: on run host
  #     run_once: true
  #     # delegate_to: localhost
  #     block:
  #     - name: Calculate percentage of successful hosts
  #       ansible.builtin.set_fact:
  #         total_hosts: "{{ ansible_play_hosts_all | length }}"
  #         failed_hosts: "{{ ansible_play_hosts | selectattr('failed', 'defined') | list | length }}"
  #         unreachable_hosts: "{{ ansible_play_hosts | selectattr('unreachable', 'undefined') | list | length }}"

  #     - name: Calc successful_hosts
  #       ansible.builtin.set_fact:
  #         successful_hosts: "{{ (total_hosts|int) - (failed_hosts|int) - (unreachable_hosts|int) }}"

  #     - name: Calc success_percentage
  #       ansible.builtin.set_fact:
  #         success_percentage: "{{ ((successful_hosts | int) / (total_hosts | int)) * 100 | round(2,'floor') | int }}"

  #     - name: Display percentage of successful hosts
  #       debug:
  #         msg: 
  #           - "{{total_hosts}} - total_hosts"
  #           - "{{failed_hosts}} - failed_hosts"
  #           - "{{unreachable_hosts}} - unreachable_hosts"
  #           - "{{successful_hosts}}|{{success_percentage }}% - successful_hosts"
