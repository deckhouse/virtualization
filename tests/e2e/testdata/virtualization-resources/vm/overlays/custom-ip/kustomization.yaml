apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
nameSuffix: "-custom-ip"
commonLabels:
  vm: custom-ip
resources:
  - ../../base
  - ./vmip.yaml
patches:
  - target:
      kind: VirtualMachine
      name: vm
    patch: |-
      - op: replace
        path: /spec/runPolicy
        value: AlwaysOn
  - target:
      kind: VirtualMachine
      name: vm
    patch: |-
      - op: add
        path: /spec/virtualMachineIPAddressName
        value: vm-custom-ip

# - target:
#     kind: VirtualMachine
#     name: vm
#   patch: |-
#     - op: add
#       path: /spec/blockDevices/-
#       value: {
#             "type": "ClusterVirtualMachineImage",
#             "clusterVirtualMachineImage": {
#                 "name": "echo"
#             }
#         }
# # remove provisioning
# - target:
#     kind: VirtualMachine
#     name: vm
#   patch: |-
#     - op: remove
#       path: /spec/provisioning
# use random ip-address
# - target:
#     kind: VirtualMachine
#     name: vm
#   patch: |-
#     - op: remove
#       path: /spec/VirtualMachineIPAddressClaimName
# - patch: |
#     $patch: delete
#     apiVersion: virtualization.deckhouse.io/v1alpha2
#     kind: VirtualMachineIPAddressClaim
#     metadata:
#       name: vm
