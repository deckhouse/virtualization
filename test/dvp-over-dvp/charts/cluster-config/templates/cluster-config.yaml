apiVersion: deckhouse.io/v1
kind: ClusterConfiguration
clusterType: Cloud
cloud:
  provider: DVP
  prefix: {{ .Values.clusterConfigurationPrefix | default "e2e" }}
podSubnetCIDR: 10.112.0.0/16
serviceSubnetCIDR: 10.223.0.0/16
kubernetesVersion: "{{ .Values.deckhouse.kubernetesVersion }}"
clusterDomain: "internal.cluster.local"
---
apiVersion: deckhouse.io/v1
kind: InitConfiguration
deckhouse:
  imagesRepo: dev-registry.deckhouse.io/sys/deckhouse-oss
  registryDockerCfg: {{ .Values.deckhouse.registryDockerCfg }}
  devBranch: {{ .Values.deckhouse.tag }}
---
apiVersion: deckhouse.io/v1
kind: DVPClusterConfiguration
layout: Standard
sshPublicKey: {{ .Values.sshPublicKey }}
masterNodeGroup:
  replicas: {{ .Values.instances.masterNodes.count }}
  instanceClass:
    virtualMachine:
      bootloader: {{ .Values.image.bootloader }}
      cpu:
        cores: {{ .Values.instances.masterNodes.cores }}
        coreFraction: {{ .Values.instances.masterNodes.coreFraction }}
      memory:
        size: {{ .Values.instances.masterNodes.memory }}
      ipAddresses:
        - Auto
      virtualMachineClassName: "{{ .Values.namespace }}-cpu"
    rootDisk:
      size: 50Gi
      storageClass: {{ .Values.storageClass }}
      image:
        kind: VirtualImage
        name: image
    etcdDisk:
      size: 15Gi
      storageClass: {{ .Values.storageClass }}
nodeGroups:
{{- range .Values.instances.additionalNodes }}
  - name: {{ .name }}
    replicas: {{ .count }}
    instanceClass:
      virtualMachine:
        bootloader: {{ .bootloader }}
        cpu:
          cores: {{ .cores }}
          coreFraction: {{ .coreFraction }}
        memory:
          size: {{ .memory }}
        virtualMachineClassName: "{{ $.Values.namespace }}-cpu"
      rootDisk:
        size: 50Gi
        image:
          kind: VirtualImage
          name: image
      additionalDisks:
      - size: 50Gi
        storageClass: {{ $.Values.storageClass }}
{{- end }}
provider:
  kubeconfigDataBase64: {{ .Values.kubeconfigDataBase64 }}
  namespace: {{ .Values.namespace }}
