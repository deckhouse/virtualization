namespaceSuffix: "e2e"

clusterTransport:
  kubeConfig: ""
  token: ""
  endpoint: ""
  insecureTls: true
  certificateAuthority: ""

helperImages:
  curlImage: "curlimages/curl"
testData:
  affinityToleration: "/tmp/testdata/affinity-toleration"
  complexTest: "/tmp/testdata/complex-test"
  diskResizing: "/tmp/testdata/disk-resizing"
  imageHotplug: "/tmp/testdata/image-hotplug"
  sizingPolicy: "/tmp/testdata/sizing-policy"
  vmConfiguration: "/tmp/testdata/vm-configuration"
  vmLabelAnnotation: "/tmp/testdata/vm-label-annotation"
  vmMigration: "/tmp/testdata/vm-migration"
  vmMigrationCancel: "/tmp/testdata/vm-migration-cancel"
  vmEvacuation: "/tmp/testdata/vm-evacuation"
  vmDiskAttachment: "/tmp/testdata/vm-disk-attachment"
  vmRestoreForce: "/tmp/testdata/vm-restore-force"
  vmRestoreSafe: "/tmp/testdata/vm-restore-safe"
  vmVersions: "/tmp/testdata/vm-versions"
  vdSnapshots: "/tmp/testdata/vd-snapshots"
  sshKey: "/tmp/testdata/sshkeys/id_ed"
  sshUser: "cloud"
  vmVpc: "/tmp/testdata/vm-vpc"
logFilter:
  - "pattern to exclude"
  - "validation failed for data source objectref" # Err.
  - "clean up failed for data source registry" # Err.
  - "the server rejected our request due to an error in our request" # Err.
  - "failed to sync powerstate" # Msg.
  - "does not have a pvc reference" # "err": "kvvm head-345e7b6a-testcases-image-hotplug/head-345e7b6a-vm-image-hotplug spec volume vi-head-345e7b6a-vi-alpine-http does not have a pvc reference"
  - "virtualmachineipaddressleases.virtualization.deckhouse.io "
  - "Failed to watch" # error if virtualization-controller restarts during tests. "msg": "Failed to watch", "err": "Get \"http://127.0.0.1:23915/apis/virtualization.deckhouse.io/v1alpha2/virtualmachinerestores?allowWatchBookmarks=true\u0026resourceVersion=709816257\u0026timeoutSeconds=310\u0026watch=true\": context canceled"
  - "leader election lost"
  - "a virtual machine cannot be restored from the pending phase with `Forced` mode" # "err": "a virtual machine cannot be restored from the pending phase with `Forced` mode; you can delete the virtual machine and restore it with `Safe` mode"
  - 'virtualMachineSnapshotSecret \"\" not found' # "msg": "virtualMachineSnapshotSecret \"\" not found"
  - 'failed to sync migrating volumes: admission webhook \"virtualmachine-validator.kubevirt.io\" denied the request: spec.template.spec.domain.devices.disks'
  - "in-flight migration detected" # "err": "admission webhook \"migration-create-validator.kubevirt.io\" denied the request: in-flight migration detected. Active migration job"
  - "the target PersistentVolumeClaim name matched the source PersistentVolumeClaim name, please report a bug"
  - "for now, migration of the rwo virtual disk is not allowed if the virtual machine has hot-plugged block devices" # {"level":"error","msg":"Error occurred during reconciliation","controller":"workload-updater-controller","err":"admission webhook \"vmop.virtualization-controller.validate.d8-virtualization\" denied the request: for now, migration of the rwo virtual disk is not allowed if the virtual machine has hot-plugged block devices","name":"example-1","namespace":"default","reconcileID":"d242d357-112b-4e75-a48f-a74ddb2c69af","time":"2025-10-02T21:19:56Z"}
  - "Too many requests: limit reached on type Namespace for key" # {"level":"error","msg":"Server rejected event (will not retry!)","err":"Too many requests: limit reached on type Namespace for key head-05d62af18-end-to-end-complex-test","event":{"count":13,"eventTime":null,"firstTimestamp":"2025-10-02T22:10:10Z","involvedObject":{"apiVersion":"virtualization.deckhouse.io/v1alpha2","kind":"VirtualMachine","name":"head-05d62af18-vm-always-on","namespace":"head-05d62af18-end-to-end-complex-test","resourceVersion":"251246482","uid":"1ba665b0-bfd1-44d2-b5e1-0dc491e7b90a"},"lastTimestamp":"2025-10-02T22:10:22Z","message":"The virtual machine configuration successfully synced","metadata":{"creationTimestamp":null,"name":"head-05d62af18-vm-always-on.186acc188a870618","namespace":"head-05d62af18-end-to-end-complex-test","resourceVersion":"251246479"},"reason":"VirtualMachineSynced","reportingComponent":"vm-controller/VirtualMachineSynced","reportingInstance":"","source":{"component":"vm-controller/VirtualMachineSynced"},"type":"Normal"},"time":"2025-10-02T22:10:22Z"}
  - "failed to detach"
  - 'failed to add finalizer \"virtualization.deckhouse.io/pod-protection\" on the \"Pod\"' # "err": "failed to add finalizer \"virtualization.deckhouse.io/pod-protection\" on the \"Pod\", \"virt-launcher-head-fc1d3f92-vm-always-on-restore-force-v6vqj\": Pod \"virt-launcher-head-fc1d3f92-vm-always-on-restore-force-v6vqj\" is invalid: metadata.finalizers: Forbidden: no new finalizers can be added if the object is being deleted, found new finalizers []string{\"virtualization.deckhouse.io/pod-protection\"}"
regexpLogFilter:
  - "failed to detach: .* not found" # "err" "failed to detach: virtualmachine.kubevirt.io \"head-497d17b-vm-automatic-with-hotplug\" not found",
  - "error patching .* not found" # "err" "error patching *** virtualimages.virtualization.deckhouse.io \"head-497d17b-vi-pvc-oref-vi-oref-vd\" not found",
  - "failed to get vmSnapshot: VirtualMachineSnapshot\\.virtualization\\.deckhouse.io .* not found" # "msg": "failed to get vmSnapshot: VirtualMachineSnapshot.virtualization.deckhouse.io \"main-to-pr14969-ynv-0-ef17ba-20250908-142437\" not found"
  - "failed to sync virtual disk data source objectref: start immediate: internalvirtualizationdatavolumes.cdi.internal.virtualization.deckhouse.io .* is forbidden: unable to create new content in namespace .* because it is being terminated" # "err": "failed to sync virtual disk data source objectref: start immediate: internalvirtualizationdatavolumes.cdi.internal.virtualization.deckhouse.io \"vd-head-b3d8865-vd-root-migration-bios-d77ea313-f469-463d-a71b-00c89ca542ab\" is forbidden: unable to create new content in namespace head-b3d8865-end-to-end-vm-migration because it is being terminated"
  - "Failed to update lock optimistically:.*leases.*leader-election-helper.*" # error during virtualization-controller lifecycle: attempt to reacquire leader election. "msg": "Failed to update lock optimistically: Put \"http://127.0.0.1:23915/apis/coordination.k8s.io/v1/namespaces/d8-virtualization/leases/d8-virt-operator-leader-election-helper?timeout=5s\": context deadline exceeded (Client.Timeout exceeded while awaiting headers), falling back to slow path"
  - "Failed to update lock: .* leases.*leader-election-helper.*" # "msg": "ock: Operation cannot be fulfilled on leases.coordination.k8s.io \"d8-virt-operator-leader-election-helper\": the object has been modified; please apply your changes to the latest version and try again",
  - "failed to create VirtualMachineIPAddress .* the specified IP address .* has already been allocated and has not been released" #     "err": "failed to create VirtualMachineIPAddress \"head-5d2c558-vm-restore-safe-tfv4w\": admission webhook \"vmip.virtualization-controller.validate.d8-virtualization\" denied the request: the VirtualMachineIPAddress cannot be created: the specified IP address 10.66.10.4 has already been allocated and has not been released"
  - "error retrieving resource lock .*leader-election-helper" #  "msg": "error retrieving resource lock d8-virtualization/d8-virt-operator-leader-election-helper: context deadline exceeded",
  - "persistentvolumeclaims .* is forbidden: unable to create new content in namespace .* because it is being terminated" # "err": "persistentvolumeclaims \"vd-f6fd1238-9cfe-4c22-bb48-cd64778740e3-\" is forbidden: unable to create new content in namespace virtualization-e2e-volume-migration-storage-class-changed-p8cxr because it is being terminated"
  - "virtualmachineoperations.virtualization.deckhouse.io .* is forbidden: unable to create new content in namespace .* because it is being terminated" # "err": "virtualmachineoperations.virtualization.deckhouse.io \"volume-migration-\" is forbidden: unable to create new content in namespace virtualization-e2e-volume-migration-storage-class-changed-qsggq because it is being terminated"
  - "error patching metadata .* devices found, 16 is maximum" # "error patching metadata ([{\"op\":\"replace\",\"path\":\"/metadata/finalizers\",\"value\":[\"virtualization.deckhouse.io/vmbda-cleanup\"]}]): admission webhook \"vmbda.virtualization-controller.validate.d8-virtualization\" denied the request: block device attached to VirtualMachine \"x-310732-worker-16758df7-qglxg-49z75\" limit reached: 17 devices found, 16 is maximum"
  - "failed to create restorer secret: secrets .* already exists" # "failed to create restorer secret: secrets \"vmsnapshot\" already exists"

cleanupResources:
  - clustervirtualimages.virtualization.deckhouse.io
  - virtualmachineclasses.virtualization.deckhouse.io
  - virtualmachineipaddressleases.virtualization.deckhouse.io
