{{- if eq (include "dvcr.isEnabled" . ) "true"}}
{{- if eq (include "dvcr.storageType" .) "PersistentVolumeClaim" }}
{{- $storageClassName := dig "dvcr" "storage" "persistentVolumeClaim" "storageClassName" "" .Values.virtualization.internal.moduleConfig }}
kind: PersistentVolumeClaim
apiVersion: v1
metadata:
  name: dvcr
  namespace: d8-{{ .Chart.Name }}
  {{- include "helm_lib_module_labels" (list . (dict "app" "dvcr")) | nindent 2 }}
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: {{ dig "dvcr" "storage" "persistentVolumeClaim" "size" "" .Values.virtualization.internal.moduleConfig | quote }}
  {{- if ne $storageClassName "" }}
  storageClassName: {{ $storageClassName }}
  {{- end }}
{{- end }}
{{- end }}
