version: "3"

tasks:
  test:
    desc: Run tests
    cmds:
      - |
        go tool ginkgo -v \
          --race \
          {{ if .FOCUS -}}
          --focus "{{ .FOCUS }}" \
          {{ end -}}
          ./...
  lint:
    desc: "Run linters locally"
    cmds:
      - task: lint:go

  lint:go:
    desc: "Run golangci-lint"
    deps:
      - _ensure:golangci-lint
    cmds:
      - |
        golangci-lint run

  _ensure:golangci-lint:
    desc: "Ensure golangci-lint is available"
    internal: true
    cmds:
      - |
        echo -e >&2 "Please install golangci-lint https://golangci-lint.run/usage/install/"
        exit 1
    status:
      - |
        [ -f ./golangci-lint ] || which golangci-lint
