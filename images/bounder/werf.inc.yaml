---
image: {{ include "ImageName" (tuple . .ImageName) }}
fromImage: {{ include "ImageName" (tuple . "distroless") }}
import:
  - image: {{ include "ImageName" (tuple . .ImageName "cbuilder") }}
    add: /bins
    to: /usr/local/bin
    after: setup
imageSpec:
  config:
    cmd: ["hello_bounder"]
---
image: {{ include "ImageName" (tuple . .ImageName "cbuilder") }}
final: false
fromImage: builder/golang-bookworm-1.23
git:
  - add: {{ include "PreffixPath" . }}/images/{{ $.ImageName }}/static_binaries
    to: /static_binaries
    stageDependencies:
      install:
        - '*.c'
shell:
  beforeInstall:
  {{- include "debian packages proxy" . | nindent 2 }}
  - apt-get install --yes musl-dev musl-tools
  {{- include "debian packages clean" . | nindent 2 }}
  install:
  - |
    cd /static_binaries
    echo "Building simple app that prints hello cdi"
    mkdir -p /bins
    musl-gcc -static -Os -o /bins/hello_bounder hello_bounder.c
    strip /bins/hello_bounder
