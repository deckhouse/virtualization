---
{{- $name := print $.ImageName "-dependencies" -}}
{{- define "$name" -}}
packages:
- glibc-utils
- mount xfsprogs xfstests util-linux e2fsprogs
libraries:
- libffi8 libssh-devel libssh2-devel
{{- end -}}

{{ $builderDependencies := include "$name" . | fromYaml }}

image: {{ $.ImageName }}
final: false
fromImage: BASE_ALT_P11
git:
  - add: /images/{{ $.ImageName }}
    to: /
    includePaths:
    - relocate_binaries.sh
shell:
  install:
    {{- include "alt packages proxy" . | nindent 2 }}
  - |
    apt-get update && apt-get install -y \
        {{ $builderDependencies.packages | join " " }} \
        {{ $builderDependencies.libraries | join " " }}
  - |
    apt-get clean
    rm --recursive --force /var/lib/apt/lists/ftp.altlinux.org* /var/cache/apt/*.bin