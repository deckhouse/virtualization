---
image: {{ .ModuleNamePrefix }}{{ .ImageName }}
fromImage: {{ .ModuleNamePrefix }}distroless
git:
  {{- include "image mount points" . }}
import:
- image: {{ .ModuleNamePrefix }}virtualization-artifact
  add: /out/virtualization-controller
  to: /app/virtualization-controller
  after: install
{{- if eq $.DEBUG_COMPONENT "delve/virtualization-controller" }}
- image: debuger
  add: /app/dlv
  to: /app/dlv
  after: install
{{- end }}
imageSpec:
  config:
    user: 64535
    workingDir: "/app"
    {{- if eq $.DEBUG_COMPONENT "delve/virtualization-controller" }}
    env:
      PATH: "/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/app/dlv"
      XDG_CONFIG_HOME: "/tmp"
    entrypoint: ["/app/dlv", "--listen=:2345", "--headless=true", "--continue", "--log=true", "--log-output=debugger,debuglineerr,gdbwire,lldbout,rpc", "--accept-multiclient", "--api-version=2", "exec", "/app/virtualization-controller", "--", "--leader-election=false"]
    {{- else }}
    entrypoint: ["/app/virtualization-controller"]
    {{- end }}
