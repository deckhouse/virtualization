From: Mate Kukri <mate.kukri@canonical.com>
Date: Thu, 20 Mar 2025 10:49:22 +0000
Subject: Revert "OvmfPkg/QemuKernelLoaderFsDxe: don't quit when named blobs
 are present"

This reverts commit c45051450efbdae4a38f07998b3e7b77abe7173a.
---
 OvmfPkg/QemuKernelLoaderFsDxe/QemuKernelLoaderFsDxe.c | 7 ++-----
 1 file changed, 2 insertions(+), 5 deletions(-)

diff --git a/OvmfPkg/QemuKernelLoaderFsDxe/QemuKernelLoaderFsDxe.c b/OvmfPkg/QemuKernelLoaderFsDxe/QemuKernelLoaderFsDxe.c
index add914d..5b90420 100644
--- a/OvmfPkg/QemuKernelLoaderFsDxe/QemuKernelLoaderFsDxe.c
+++ b/OvmfPkg/QemuKernelLoaderFsDxe/QemuKernelLoaderFsDxe.c
@@ -71,7 +71,6 @@ STATIC KERNEL_BLOB_ITEMS  mKernelBlobItems[] = {
 
 STATIC KERNEL_BLOB  *mKernelBlobs;
 STATIC UINT64       mKernelBlobCount;
-STATIC UINT64       mKernelNamedBlobCount;
 STATIC UINT64       mTotalBlobBytes;
 
 //
@@ -1140,8 +1139,6 @@ QemuKernelFetchNamedBlobs (
       FreePool (DirEntry);
       return Status;
     }
-
-    mKernelNamedBlobCount++;
   }
 
   FreePool (DirEntry);
@@ -1221,8 +1218,8 @@ QemuKernelLoaderFsDxeEntrypoint (
   }
 
   Blob = FindKernelBlob (L"kernel");
-  if ((Blob == NULL) && (mKernelNamedBlobCount == 0)) {
-    DEBUG ((DEBUG_INFO, "%a: no kernel and no named blobs present -> quit\n", __func__));
+  if (Blob == NULL) {
+    DEBUG ((DEBUG_INFO, "%a: no kernel present -> quit\n", __func__));
     Status = EFI_NOT_FOUND;
     goto FreeBlobs;
   }
