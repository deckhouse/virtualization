From f35f400c9255be5fbb0158c6885a96ef23e7fb86 Mon Sep 17 00:00:00 2001
From: Sebastian Ott <sebott@redhat.com>
Date: Thu, 5 Sep 2024 12:54:34 +0200
Subject: x86: ensure compatibility of pc-q35-rhel9* and pc-i440fx-rhel7.6.0

Signed-off-by: Sebastian Ott <sebott@redhat.com>
---
 hw/i386/pc_piix.c | 3 +++
 hw/i386/pc_q35.c  | 3 +++
 2 files changed, 6 insertions(+)

diff --git a/hw/i386/pc_piix.c b/hw/i386/pc_piix.c
index 80323cc08c..656abb5d39 100644
--- a/hw/i386/pc_piix.c
+++ b/hw/i386/pc_piix.c
@@ -872,6 +872,9 @@ static void pc_i440fx_rhel_machine_7_6_0_options(MachineClass *m)
     pcmc->broken_32bit_mem_addr_check = true;
     /* Introduced in QEMU 8.2 */
     pcmc->default_south_bridge = TYPE_PIIX3_DEVICE;
+    /* From pc_i440fx_machine_9_0_options() */
+    m->smbios_memory_device_size = 16 * GiB;
+    pcmc->isa_bios_alias = false;
 
     object_class_property_add_enum(oc, "x-south-bridge", "PCSouthBridgeOption",
                                    &PCSouthBridgeOption_lookup,
diff --git a/hw/i386/pc_q35.c b/hw/i386/pc_q35.c
index 4580b2266e..5cfed8b62f 100644
--- a/hw/i386/pc_q35.c
+++ b/hw/i386/pc_q35.c
@@ -679,7 +679,10 @@ static void pc_q35_rhel_machine_9_4_0_options(MachineClass *m)
     m->desc = "RHEL-9.4.0 PC (Q35 + ICH9, 2009)";
     pcmc->smbios_stream_product = "RHEL";
     pcmc->smbios_stream_version = "9.4.0";
+
+    /* From pc_q35_machine_9_0_options() */
     pcmc->isa_bios_alias = false;
+    m->smbios_memory_device_size = 16 * GiB;
 
     compat_props_add(m->compat_props, hw_compat_rhel_9_6,
                      hw_compat_rhel_9_6_len);
-- 
2.39.3

