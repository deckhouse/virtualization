---
image: {{ $.ImageName }}
from: {{ $.Images.BASE_SCRATCH }}
# fromImage: dvcr-artifact
import:
- image: {{ $.ImageName }}-bins
  add: /relocate
  to: /
  after: install
- image: dvcr-artifact-builder
  add: /out
  to: /usr/local/bin
  includePaths:
  - dvcr-uploader
  after: install
git:
- add: /images/dvcr-artifact/build
  to: /
  includePaths:
    - uploader_entrypoint.sh
  stageDependencies:
    setup: ['*']
docker:
  WORKDIR: "/"
  CMD: ["/usr/local/bin/dvcr-uploader"]
  USER: 64535
---
{{- $binaries := "/usr/bin/sh /usr/bin/rm /usr/bin/grep" }}

image: {{ $.ImageName }}-bins
final: false
fromImage: base-alt-p11-binaries
shell:
  beforeInstall:
  - |
    /relocate_binaries.sh -i "{{ $binaries }}" -o /relocate