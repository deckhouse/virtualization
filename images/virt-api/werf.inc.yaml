---
image: {{ .ModuleNamePrefix }}{{ .ImageName }}
fromImage: {{ .ModuleNamePrefix }}distroless
import:
- image: {{ .ModuleNamePrefix }}virt-artifact
  add: /kubevirt-binaries/
  to: /usr/bin
  includePaths:
  - virt-api
  before: setup
- image: {{ .ModuleNamePrefix }}virt-artifact
  add: /kubevirt-config-files/
  to: /etc
  includePaths:
  - .version
  before: setup
# Source https://github.com/kubevirt/kubevirt/blob/v1.3.1/cmd/virt-api/BUILD.bazel
imageSpec:
  config:
    user: 64535
    {{- if and (eq $.DELVE_DEBUG "true") (eq $.COMPONENT_DEBUG "delve/virt-api") }}
    env:
      PATH: "/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/app/dlv"
      XDG_CONFIG_HOME: "/tmp"
    entrypoint: ["dlv", "--listen=:2345", "--headless=true", "--continue", "--log=true", "--log-output=debugger,debuglineerr,gdbwire,lldbout,rpc", "--accept-multiclient", "--api-version=2", "exec", "/app/virt-api", "--"]
    {{- else }}
    entrypoint: ["/usr/bin/virt-api"]
    {{- end }}
