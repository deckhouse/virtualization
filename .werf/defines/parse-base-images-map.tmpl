{{- define "parse_base_images_map" }}
  {{- $virtualizationImages := .Files.Get "base-images/virtualization_images.yml" | fromYaml }}
  {{- $deckhouseImages := .Files.Get "base-images/deckhouse_images.yml" | fromYaml }}
  
  {{- range $k, $v := $virtualizationImages }}
    {{ $baseImagePath := (printf "%s%s" $virtualizationImages.REGISTRY_PATH (trimSuffix "/" $v)) }}
    {{- if ne $k "REGISTRY_PATH" }}
      {{- $_ := set $virtualizationImages $k $baseImagePath }}
    {{- end }}
  {{- end }}
  {{- $_ := unset $virtualizationImages "REGISTRY_PATH" }}

  {{- range $k, $v := $deckhouseImages }}
    {{ $baseImagePath := (printf "%s@%s" $deckhouseImages.REGISTRY_PATH (trimSuffix "/" $v)) }}
    {{- if ne $k "REGISTRY_PATH" }}
      {{- $_ := set $deckhouseImages $k $baseImagePath }}
    {{- end }}
  {{- end }}
  {{- $_ := unset $deckhouseImages "REGISTRY_PATH" }}

  {{- $_ := set . "Images" (mustMerge $virtualizationImages $deckhouseImages) }}
  # base images artifacts
  {{- range $k, $v := .Images }}
---
image: {{ $k }}
from: {{ $v }}
final: false
  {{- end }}
{{- end }}