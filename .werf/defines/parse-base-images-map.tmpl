{{- define "parse_base_images_map" }}
  {{- $altImageVersions := .Files.Get "base-images/alt_image_versions.yml" | fromYaml }}
  {{- $imageVersions := .Files.Get "base-images/image_versions.yml" | fromYaml }}
  {{- $baseImages := .Files.Get "base-images/base_images.yml" | fromYaml }}
  
  {{- range $k, $v := $altImageVersions }}
    {{ $baseImagePath := (printf "%s%s" $altImageVersions.REGISTRY_PATH (trimSuffix "/" $v)) }}
    {{- if ne $k "REGISTRY_PATH" }}
      {{- $_ := set $altImageVersions $k $baseImagePath }}
    {{- end }}
  {{- end }}
  {{- $_ := unset $altImageVersions "REGISTRY_PATH" }}
  
  {{- range $k, $v := $imageVersions }}
    {{ $baseImagePath := (printf "%s%s" $imageVersions.REGISTRY_PATH (trimSuffix "/" $v)) }}
    {{- if ne $k "REGISTRY_PATH" }}
      {{- $_ := set $imageVersions $k $baseImagePath }}
    {{- end }}
  {{- end }}
  {{- $_ := unset $imageVersions "REGISTRY_PATH" }}

  {{- range $k, $v := $baseImages }}
    {{ $baseImagePath := (printf "%s@%s" $baseImages.REGISTRY_PATH (trimSuffix "/" $v)) }}
    {{- if ne $k "REGISTRY_PATH" }}
      {{- $_ := set $baseImages $k $baseImagePath }}
    {{- end }}
  {{- end }}
  {{- $_ := unset $baseImages "REGISTRY_PATH" }}

  {{- $_ := set . "Images" (mustMerge $altImageVersions $imageVersions $baseImages) }}
  # base images artifacts
  {{- range $k, $v := .Images }}
---
image: {{ $k }}
from: {{ $v }}
final: false
  {{- end }}
{{- end }}